version: 1.0
kind: netbox-mermaid-mapping

globals:
  indentation: "  "
  line_separator: "\n"

  anchors:
    enabled: true
    start: "%% BEGIN {{id}}"
    end: "%% END {{id}}"


roots:
  infrastructure:
    mermaid:
      type: subgraph
      id: infrastructure
      label: "*Infrastructure*"

  definitions:
    mermaid:
      type: subgraph
      id: definitions
      label: "*Definitions*"


entities:

  region:
    mermaid:
      kind: structural
      type: subgraph
      id: "region_{{ object.id }}"
    label: "region: {{ object.name }}"


  site:
    mermaid:
      kind: structural
      type: subgraph
      id: "site_{{ object.id }}"
    label: "site: {{ object.name }}"


  site-group:
    mermaid:
      kind: structural
      type: subgraph
      # Mermaid flowchart identifiers are safest with underscores.
      # We keep the domain entity name as 'site-group' but render as 'site_group_<id>'.
      id: "site_group_{{ object.id }}"
    label: "site-group: {{ object.name }}"


  location:
    mermaid:
      kind: structural
      type: subgraph
      id: "location_{{ object.id }}"
    label: "location: {{ object.name }}"


  tenant-group:
    mermaid:
      kind: structural
      type: subgraph
      id: "tenant_group_{{ object.id }}"
    label: "tenant-group: {{ object.name }}"


  tenant:
    mermaid:
      kind: structural
      type: subgraph
      id: "tenant_{{ object.id }}"
    label: "tenant: {{ object.name }}"


  manufacturer:
    mermaid:
      kind: structural
      type: subgraph
      id: "manufacturer_{{ object.id }}"
    label: "manufacturer: {{ object.name }}"


  device-role:
    mermaid:
      kind: structural
      type: subgraph
      id: "device_role_{{ object.id }}"
    label: "device-role: {{ object.name }}"


  platform:
    mermaid:
      kind: structural
      type: subgraph
      id: "platform_{{ object.id }}"
    label: "platform: {{ object.name }}"


  device-type:
    mermaid:
      kind: structural
      type: subgraph
      id: "device_type_{{ object.id }}"
    label: "device-type: {{ object.name }}"


  rack-type:
    mermaid:
      kind: structural
      type: subgraph
      id: "rack_type_{{ object.id }}"
    label: "rack-type: {{ object.name }}"


  virtual-chassis:
    mermaid:
      kind: structural
      type: subgraph
      id: "virtual_chassis_{{ object.id }}"
    label: "virtual-chassis: {{ object.name }}"


  rack:
    mermaid:
      kind: structural
      type: subgraph
      id: "rack_{{ object.id }}"
    label: "rack: {{ object.name }}"


  device:
    mermaid:
      kind: structural
      type: subgraph
      id: "device_{{ object.id }}"
    label: "device: {{ object.name }}"


  interface:
    mermaid:
      kind: node
      type: node
      id: "if_{{ object.id }}"
      label: "{{ object.name }}"
      shape: rounded


connections:

  interface_link:
    from: interface
    to: interface

    scope:
      root: infrastructure
      container: connections

    mermaid:
      template: "{{ from.id }} <--> {{ to.id }}"


others:
  attributes:
    mermaid:
      kind: node
      type: comment
      id: "attr_{{ object.mermaidId }}"
      template: |
        {{ id }}@{ shape: comment, label: "{{ label }}" }
