version: 1.0
kind: netbox-mermaid-mapping

globals:
  indentation: "  "
  line_separator: "\n"

  anchors:
    enabled: true
    start: "%% BEGIN {{id}}"
    end: "%% END {{id}}"


roots:
  infrastructure:
    mermaid:
      type: subgraph
      id: infrastructure
      label: "*Infrastructure*"

  definitions:
    mermaid:
      type: subgraph
      id: definitions
      label: "*Definitions*"


entities:

  region:
    mermaid:
      kind: structural
      type: subgraph
      id: "region_{{ object.id }}"
      label: "*{{ object.name }}*"


  site:
    mermaid:
      kind: structural
      type: subgraph
      id: "site_{{ object.id }}"
      label: "*{{ object.name }}*"


  site-group:
    mermaid:
      kind: structural
      type: subgraph
      # Mermaid flowchart identifiers are safest with underscores.
      # We keep the domain entity name as 'site-group' but render as 'site_group_<id>'.
      id: "site_group_{{ object.id }}"
      label: "*{{ object.name }}*"


  location:
    mermaid:
      kind: structural
      type: subgraph
      id: "location_{{ object.id }}"
      label: "*{{ object.name }}*"


  rack:
    mermaid:
      kind: structural
      type: subgraph
      id: "rack_{{ object.id }}"
      label: "*{{ object.name }}*"


  device:
    mermaid:
      kind: structural
      type: subgraph
      id: "device_{{ object.id }}"
      label: "*{{ object.name }}*"


  interface:
    mermaid:
      kind: node
      type: node
      id: "if_{{ object.id }}"
      label: "{{ object.name }}"
      shape: rounded


connections:

  interface_link:
    from: interface
    to: interface

    scope:
      root: infrastructure
      container: connections

    mermaid:
      template: "{{ from.id }} <--> {{ to.id }}"


others:
  attributes:
    mermaid:
      kind: node
      type: comment
      id: "attr_{{ object.mermaidId }}"
      template: |
        {{ id }}@{ shape: comment, label: "{{ label }}" }
